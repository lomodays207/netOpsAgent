<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>localStorage æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }

        .output {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <h1>ğŸ§ª localStorage åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>1. ä¿å­˜æµ‹è¯•æ•°æ®</h2>
        <button onclick="saveTestData()">ä¿å­˜ä¼šè¯IDå’Œæ¶ˆæ¯</button>
        <div id="save-output" class="output"></div>
    </div>

    <div class="test-section">
        <h2>2. è¯»å–æµ‹è¯•æ•°æ®</h2>
        <button onclick="loadTestData()">è¯»å–ä¿å­˜çš„æ•°æ®</button>
        <div id="load-output" class="output"></div>
    </div>

    <div class="test-section">
        <h2>3. æ¸…é™¤æµ‹è¯•æ•°æ®</h2>
        <button onclick="clearTestData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
        <div id="clear-output" class="output"></div>
    </div>

    <div class="test-section">
        <h2>4. æŸ¥çœ‹æ‰€æœ‰ localStorage</h2>
        <button onclick="showAllStorage()">æ˜¾ç¤ºæ‰€æœ‰å­˜å‚¨</button>
        <div id="all-output" class="output"></div>
    </div>

    <script>
        function saveTestData() {
            const output = document.getElementById('save-output');
            try {
                // ä¿å­˜ä¼šè¯ID
                const sessionId = 'test_session_' + Date.now();
                localStorage.setItem('currentSessionId', sessionId);

                // ä¿å­˜æ¶ˆæ¯
                const messages = [
                    { role: 'user', content: 'æµ‹è¯•æ¶ˆæ¯1', timestamp: new Date().toISOString() },
                    { role: 'assistant', content: 'æµ‹è¯•å›å¤1', timestamp: new Date().toISOString() }
                ];
                localStorage.setItem('chatMessages', JSON.stringify(messages));

                output.innerHTML = `<span class="success">âœ… ä¿å­˜æˆåŠŸï¼</span>\n`;
                output.innerHTML += `ä¼šè¯ID: ${sessionId}\n`;
                output.innerHTML += `æ¶ˆæ¯æ•°é‡: ${messages.length}`;
            } catch (e) {
                output.innerHTML = `<span class="error">âŒ ä¿å­˜å¤±è´¥: ${e.message}</span>`;
            }
        }

        function loadTestData() {
            const output = document.getElementById('load-output');
            try {
                const sessionId = localStorage.getItem('currentSessionId');
                const messagesStr = localStorage.getItem('chatMessages');

                if (!sessionId && !messagesStr) {
                    output.innerHTML = '<span class="error">âš ï¸ æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ•°æ®</span>';
                    return;
                }

                output.innerHTML = `<span class="success">âœ… è¯»å–æˆåŠŸï¼</span>\n\n`;
                output.innerHTML += `ä¼šè¯ID: ${sessionId || '(æ— )'}\n\n`;

                if (messagesStr) {
                    const messages = JSON.parse(messagesStr);
                    output.innerHTML += `æ¶ˆæ¯å†å² (${messages.length}æ¡):\n`;
                    messages.forEach((msg, i) => {
                        output.innerHTML += `  ${i + 1}. [${msg.role}] ${msg.content}\n`;
                    });
                }
            } catch (e) {
                output.innerHTML = `<span class="error">âŒ è¯»å–å¤±è´¥: ${e.message}</span>`;
            }
        }

        function clearTestData() {
            const output = document.getElementById('clear-output');
            try {
                localStorage.removeItem('currentSessionId');
                localStorage.removeItem('chatMessages');
                output.innerHTML = '<span class="success">âœ… æ•°æ®å·²æ¸…é™¤</span>';
            } catch (e) {
                output.innerHTML = `<span class="error">âŒ æ¸…é™¤å¤±è´¥: ${e.message}</span>`;
            }
        }

        function showAllStorage() {
            const output = document.getElementById('all-output');
            try {
                output.innerHTML = `localStorage ä¸­çš„æ‰€æœ‰æ•°æ®:\n\n`;
                if (localStorage.length === 0) {
                    output.innerHTML += '(ç©º)';
                } else {
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        const value = localStorage.getItem(key);
                        output.innerHTML += `${key}:\n${value}\n\n`;
                    }
                }
            } catch (e) {
                output.innerHTML = `<span class="error">âŒ é”™è¯¯: ${e.message}</span>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºå½“å‰å­˜å‚¨
        window.addEventListener('load', () => {
            showAllStorage();
        });
    </script>
</body>

</html>