# å‰ç«¯ä¼šè¯æŒä¹…åŒ–åŠŸèƒ½è¯´æ˜Ž

## æ–°å¢žåŠŸèƒ½

### 1. ä¼šè¯æŒä¹…åŒ–
- âœ… ä½¿ç”¨ `localStorage` ä¿å­˜ä¼šè¯IDå’Œå¯¹è¯åŽ†å²
- âœ… é¡µé¢åˆ·æ–°åŽè‡ªåŠ¨æ¢å¤ä¼šè¯
- âœ… å¯ä»¥ç»§ç»­ä¹‹å‰çš„å¯¹è¯

### 2. æ–°å¯¹è¯æŒ‰é’®
- âœ… é¡µé¢å³ä¸Šè§’æ·»åŠ "ðŸ†• æ–°å¯¹è¯"æŒ‰é’®
- âœ… ç‚¹å‡»å¯æ¸…é™¤å½“å‰ä¼šè¯ï¼Œå¼€å§‹æ–°å¯¹è¯

### 3. ä¼šè¯æ¢å¤æç¤º
- âœ… æ¢å¤ä¼šè¯æ—¶æ˜¾ç¤ºç³»ç»Ÿæç¤ºæ¶ˆæ¯
- âœ… æ˜¾ç¤ºä¼šè¯IDå‰20ä¸ªå­—ç¬¦

## å·¥ä½œåŽŸç†

### localStorage å­˜å‚¨å†…å®¹

1. **currentSessionId**: å½“å‰ä¼šè¯çš„ID
   ```javascript
   localStorage.setItem('currentSessionId', 'task_20260125220400_a1b2c3d4');
   ```

2. **chatMessages**: å¯¹è¯åŽ†å²ï¼ˆJSONæ•°ç»„ï¼‰
   ```javascript
   [
     { role: 'user', content: '10.0.1.10åˆ°10.0.2.20ç«¯å£80ä¸é€š', timestamp: '2026-01-25T22:04:00.000Z' },
     { role: 'assistant', content: 'å¼€å§‹è¯Šæ–­...', timestamp: '2026-01-25T22:04:01.000Z' }
   ]
   ```

### é¡µé¢åŠ è½½æµç¨‹

1. **é¡µé¢åŠ è½½** â†’ è°ƒç”¨ `restoreSession()`
2. **æ£€æŸ¥ localStorage** â†’ è¯»å– `currentSessionId` å’Œ `chatMessages`
3. **æ¢å¤æ¶ˆæ¯** â†’ é‡æ–°æ¸²æŸ“åŽ†å²å¯¹è¯
4. **æ˜¾ç¤ºæç¤º** â†’ å‘ŠçŸ¥ç”¨æˆ·ä¼šè¯å·²æ¢å¤

### å‘é€æ¶ˆæ¯æµç¨‹

1. **ç”¨æˆ·è¾“å…¥** â†’ è°ƒç”¨ `addUserMessage(text, true)`
2. **ä¿å­˜æ¶ˆæ¯** â†’ `saveMessage('user', text)` å†™å…¥ localStorage
3. **å‘é€è¯·æ±‚** â†’ å¦‚æžœæœ‰ `currentSessionId`ï¼Œè°ƒç”¨ `/api/v1/chat/answer`ï¼Œå¦åˆ™è°ƒç”¨ `/api/v1/diagnose/stream`
4. **æŽ¥æ”¶å“åº”** â†’ ä¿å­˜åŠ©æ‰‹æ¶ˆæ¯åˆ° localStorage

### æ–°å¯¹è¯æµç¨‹

1. **ç‚¹å‡»æŒ‰é’®** â†’ å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
2. **ç¡®è®¤** â†’ è°ƒç”¨ `clearSession()`
3. **æ¸…é™¤æ•°æ®** â†’ åˆ é™¤ localStorage ä¸­çš„ä¼šè¯æ•°æ®
4. **æ¸…ç©ºç•Œé¢** â†’ æ¸…ç©ºæ¶ˆæ¯å®¹å™¨

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1: åŸºæœ¬å¯¹è¯æŒä¹…åŒ–

1. æ‰“å¼€ http://localhost:8000/
2. è¾“å…¥æ•…éšœæè¿°ï¼Œä¾‹å¦‚ï¼š"10.0.1.10åˆ°10.0.2.20ç«¯å£80ä¸é€š"
3. ç­‰å¾…è¯Šæ–­å¼€å§‹ï¼Œè®°å½•ä¼šè¯ID
4. **åˆ·æ–°é¡µé¢** (F5)
5. âœ… éªŒè¯ï¼šå¯¹è¯åŽ†å²åº”è¯¥æ¢å¤ï¼Œæ˜¾ç¤º"ä¼šè¯å·²æ¢å¤"æç¤º

### æµ‹è¯•2: å¤šè½®å¯¹è¯æŒä¹…åŒ–

1. æ‰“å¼€ http://localhost:8000/
2. è¾“å…¥æ•…éšœæè¿°
3. å¦‚æžœLLMè¯¢é—®é—®é¢˜ï¼Œå›žç­”é—®é¢˜
4. **åˆ·æ–°é¡µé¢**
5. âœ… éªŒè¯ï¼šæ‰€æœ‰å¯¹è¯åŽ†å²éƒ½åº”è¯¥æ¢å¤
6. ç»§ç»­è¾“å…¥ï¼ŒéªŒè¯å¯ä»¥ç»§ç»­å¯¹è¯

### æµ‹è¯•3: æ–°å¯¹è¯åŠŸèƒ½

1. åœ¨æœ‰å¯¹è¯åŽ†å²çš„æƒ…å†µä¸‹
2. ç‚¹å‡»å³ä¸Šè§’"ðŸ†• æ–°å¯¹è¯"æŒ‰é’®
3. ç¡®è®¤å¯¹è¯æ¡†
4. âœ… éªŒè¯ï¼šå¯¹è¯åŽ†å²è¢«æ¸…ç©ºï¼Œå¯ä»¥å¼€å§‹æ–°å¯¹è¯

### æµ‹è¯•4: è·¨æµè§ˆå™¨æ ‡ç­¾é¡µ

1. åœ¨æ ‡ç­¾é¡µAå¼€å§‹å¯¹è¯
2. æ‰“å¼€æ–°æ ‡ç­¾é¡µBï¼Œè®¿é—® http://localhost:8000/
3. âœ… éªŒè¯ï¼šæ ‡ç­¾é¡µBåº”è¯¥æ¢å¤æ ‡ç­¾é¡µAçš„ä¼šè¯
4. åœ¨æ ‡ç­¾é¡µBç»§ç»­å¯¹è¯
5. åˆ·æ–°æ ‡ç­¾é¡µA
6. âœ… éªŒè¯ï¼šæ ‡ç­¾é¡µAåº”è¯¥çœ‹åˆ°æœ€æ–°çš„å¯¹è¯

## æ³¨æ„äº‹é¡¹

### é™åˆ¶

1. **æ¶ˆæ¯æ•°é‡é™åˆ¶**: æœ€å¤šä¿å­˜100æ¡æ¶ˆæ¯ï¼ˆé˜²æ­¢ localStorage æº¢å‡ºï¼‰
2. **æµè§ˆå™¨é™åˆ¶**: localStorage å¤§å°é™åˆ¶çº¦5-10MB
3. **åŒæºç­–ç•¥**: åªåœ¨åŒä¸€åŸŸåä¸‹æœ‰æ•ˆ

### å·²çŸ¥é—®é¢˜

1. **å·¥å…·è°ƒç”¨åŽ†å²**: ç›®å‰åªä¿å­˜æ–‡æœ¬æ¶ˆæ¯ï¼Œä¸ä¿å­˜å·¥å…·è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯
2. **å¯Œæ–‡æœ¬å†…å®¹**: å¤æ‚çš„HTMLå†…å®¹å¯èƒ½æ— æ³•å®Œå…¨æ¢å¤
3. **å®žæ—¶åŒæ­¥**: å¤šä¸ªæ ‡ç­¾é¡µä¹‹é—´ä¸ä¼šå®žæ—¶åŒæ­¥ï¼ˆéœ€è¦åˆ·æ–°ï¼‰

## åŽç«¯é›†æˆ

å‰ç«¯çš„ `currentSessionId` ä¼šåœ¨åŽç»­è¯·æ±‚ä¸­å‘é€åˆ°åŽç«¯ï¼š

```javascript
// ç»§ç»­å¯¹è¯è¯·æ±‚
fetch('/api/v1/chat/answer', {
    method: 'POST',
    body: JSON.stringify({
        session_id: currentSessionId,  // ä»Ž localStorage æ¢å¤çš„ä¼šè¯ID
        answer: userInput
    })
})
```

åŽç«¯ä¼šï¼š
1. ä»Ž SQLite æ•°æ®åº“æ¢å¤ä¼šè¯
2. é‡å»º Agent å’Œ LLMClient
3. æ¢å¤ä¸Šä¸‹æ–‡
4. ç»§ç»­è¯Šæ–­æµç¨‹

## å®Œæ•´çš„æŒä¹…åŒ–æµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â†“
å‰ç«¯ä¿å­˜åˆ° localStorage (ä¼šè¯ID + æ¶ˆæ¯)
    â†“
å‘é€åˆ°åŽç«¯ API
    â†“
åŽç«¯ä¿å­˜åˆ° SQLite (ä¼šè¯ + æ¶ˆæ¯ + ä¸Šä¸‹æ–‡)
    â†“
é¡µé¢åˆ·æ–°
    â†“
å‰ç«¯ä»Ž localStorage æ¢å¤ (ä¼šè¯ID + æ¶ˆæ¯åŽ†å²)
    â†“
ç”¨æˆ·ç»§ç»­è¾“å…¥
    â†“
å‰ç«¯å‘é€ä¼šè¯IDåˆ°åŽç«¯
    â†“
åŽç«¯ä»Ž SQLite æ¢å¤ä¼šè¯ (é‡å»º Agent + ä¸Šä¸‹æ–‡)
    â†“
ç»§ç»­è¯Šæ–­
```

## å¼€å‘è€…å·¥å…·è°ƒè¯•

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)ï¼š

### æŸ¥çœ‹ localStorage
```javascript
// æŽ§åˆ¶å°æ‰§è¡Œ
localStorage.getItem('currentSessionId')
localStorage.getItem('chatMessages')
```

### æ¸…é™¤ localStorage
```javascript
// æŽ§åˆ¶å°æ‰§è¡Œ
localStorage.clear()
```

### ç›‘å¬å­˜å‚¨äº‹ä»¶
```javascript
window.addEventListener('storage', (e) => {
    console.log('Storage changed:', e.key, e.newValue);
});
```
